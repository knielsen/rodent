diff --git a/cmake/CheckIncludeFiles.cmake b/cmake/CheckIncludeFiles.cmake
index f5dde97..5aaabc8 100644
--- a/cmake/CheckIncludeFiles.cmake
+++ b/cmake/CheckIncludeFiles.cmake
@@ -66,3 +66,4 @@ CHECK_INCLUDE_FILES (termio.h HAVE_TERMIO_H)
 CHECK_INCLUDE_FILES (termios.h HAVE_TERMIOS_H)
 CHECK_INCLUDE_FILES (unistd.h HAVE_UNISTD_H)
 CHECK_INCLUDE_FILES (utime.h HAVE_UTIME_H)
+CHECK_INCLUDE_FILES (ucontext.h HAVE_UCONTEXT_H)
diff --git a/include/my_config.h.in b/include/my_config.h.in
index a1181d0..dc18772 100644
--- a/include/my_config.h.in
+++ b/include/my_config.h.in
@@ -46,6 +46,7 @@
 #cmakedefine HAVE_TERMIOS_H 1
 #cmakedefine HAVE_UNISTD_H 1
 #cmakedefine HAVE_UTIME_H 1
+#cmakedefine HAVE_UCONTEXT_H 1
 
 /*
  * function definitions - processed in LibmysqlFunctions.txt 
diff --git a/include/my_context.h b/include/my_context.h
index b66482a..2cc40d2 100644
--- a/include/my_context.h
+++ b/include/my_context.h
@@ -31,7 +31,7 @@
 #define MY_CONTEXT_USE_X86_64_GCC_ASM
 #elif defined(__GNUC__) && __GNUC__ >= 3 && defined(__i386__)
 #define MY_CONTEXT_USE_I386_GCC_ASM
-#elif defined(HAVE_UCONTEXT)
+#elif defined(HAVE_UCONTEXT_H)
 #define MY_CONTEXT_USE_UCONTEXT
 #else
 #define MY_CONTEXT_DISABLE
diff --git a/libmariadb/my_context.c b/libmariadb/my_context.c
index 545cfe8..0fda2a7 100644
--- a/libmariadb/my_context.c
+++ b/libmariadb/my_context.c
@@ -20,6 +20,7 @@
   swapcontext().
 */
 
+#include "my_global.h"
 #include "mysys_priv.h"
 #include "m_string.h"
 #include "my_context.h"
